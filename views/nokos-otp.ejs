<!DOCTYPE html>
<html lang="en">
<head>
    <title>Transaksi Detail</title>
    <script src="https://unpkg.com/react/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"></link>
</head>
<body class="bg-gray-100">
    <div id="root"></div>

    <!-- Data dinamis yang diambil dari server -->
    <script type="text/javascript">
        window.USER_DATA = {
            country: "<%= country %>",  // Mengambil data negara dari backend
            serviceId: "<%= serviceId %>",  // Mengambil data ID layanan dari backend
            phoneNumber: "<%= phoneNumber %>",  // Mengambil nomor telepon dari backend
            price: "<%= price %>",  // Harga layanan
            tersedia: "<%= tersedia %>",  // Jumlah stok tersedia
            countdown: "<%= countdown %>"  // Mengambil countdown dari session
        };
    </script>

    <script type="text/babel">
        function App() {
            const initialTime = window.USER_DATA.countdown; // Ambil countdown dari backend
            const [timeLeft, setTimeLeft] = React.useState(initialTime);
            const [otp, setOtp] = React.useState('');

            const { country, serviceId, phoneNumber, price, tersedia } = window.USER_DATA;

            React.useEffect(() => {
                const interval = setInterval(() => {
                    setTimeLeft(prevTime => {
                        const newTime = prevTime - 1;
                        if (newTime >= 0) {
                            // Simpan countdown yang tersisa ke sessionStorage
                            sessionStorage.setItem(`${phoneNumber}-${serviceId}`, newTime);
                        }
                        return newTime;
                    });
                }, 1000);

                return () => clearInterval(interval);
            }, [phoneNumber, serviceId]);

            const formatTime = (seconds) => {
                const minutes = Math.floor(seconds / 60);
                const remainingSeconds = seconds % 60;
                return `${minutes}:${remainingSeconds < 10 ? '0' : ''}${remainingSeconds}`;
            };

            const currentDate = new Date().toLocaleDateString('id-ID', {
                day: '2-digit',
                month: 'short',
                year: 'numeric'
            });

            return (
                <div className="max-w-md mx-auto bg-white rounded-xl shadow-md overflow-hidden md:max-w-2xl mt-10">
                    <div className="p-4">
                        <div className="flex items-center justify-between">
                            <i className="fas fa-arrow-left text-gray-600"></i>
                            <h1 className="text-xl font-semibold text-center flex-grow">Transaksi Detail</h1>
                        </div>
                        <div className="mt-4 p-4 bg-gray-100 rounded-lg">
                            <div className="flex items-center">
                                <img src="https://placehold.co/40x40" alt="WhatsApp icon" className="w-10 h-10 rounded-full"/>
                                <div className="ml-4">
                                    <p className="text-lg font-semibold">{phoneNumber}</p>
                                    <p className="text-gray-500">{country} - {serviceId}</p>
                                </div>
                                <i className="fas fa-copy text-gray-600 ml-auto"></i>
                            </div>
                            <div className="mt-4 grid grid-cols-3 text-center">
                                <div>
                                    <p className="text-gray-500">Tanggal</p>
                                    <p className="font-semibold">{currentDate}</p>
                                </div>
                                <div>
                                    <p className="text-gray-500">Status</p>
                                    <p className="font-semibold">Pending</p>
                                </div>
                                <div>
                                    <p className="text-gray-500">Sisa waktu</p>
                                    <p className="font-semibold">{formatTime(timeLeft)}</p>
                                </div>
                            </div>
                        </div>
                        <div className="mt-4 p-4 bg-blue-500 text-white rounded-lg flex justify-between items-center">
                            <div>
                                <p className="text-sm">Menunggu Kode SMS</p>
                                <p className="text-lg font-semibold">Kode Anda</p>
                            </div>
                            <input 
                                type="text" 
                                value={otp} 
                                onChange={(e) => setOtp(e.target.value)} 
                                className="bg-white text-black rounded-lg p-2 w-32 text-center" 
                                placeholder="123-456"
                            />
                        </div>
                        <div className="mt-4 p-4 bg-gray-100 rounded-lg">
                            <div className="flex items-center justify-between">
                                <p className="text-sm">Harga:</p>
                                <p className="font-semibold">Rp {parseInt(price).toLocaleString('id-ID')}</p>
                            </div>
                            <div className="flex items-center justify-between">
                                <p className="text-sm">Tersedia:</p>
                                <p className="font-semibold">{tersedia} Pcs</p>
                            </div>
                        </div>
                        <div className="mt-4 flex space-x-4">
                            <button className="flex-grow bg-blue-500 text-white py-2 rounded-lg">Ready</button>
                            <button className="flex-grow bg-gray-300 text-gray-700 py-2 rounded-lg">Cancel</button>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
